<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>AR Dual Video</title>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.143.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-three.prod.js"></script>
</head>
<body>
  <script>
    window.addEventListener("DOMContentLoaded", async () => {
      const mindarThree = new window.MINDAR.IMAGE.MindARThree({
        container: document.body,
        imageTargetSrc: "./maintarget.mind",
      });

      const { renderer, scene, camera } = mindarThree;

      const video = document.createElement("video");
      video.src = "./circuit_3_color.mp4";
      video.crossOrigin = "anonymous";
      video.loop = true;
      video.muted = true;
      video.setAttribute("playsinline", "");
      await video.play();

      const alphaVideo = document.createElement("video");
      alphaVideo.src = "./circuit_3_alpha.mp4";
      alphaVideo.crossOrigin = "anonymous";
      alphaVideo.loop = true;
      alphaVideo.muted = true;
      alphaVideo.setAttribute("playsinline", "");
      await alphaVideo.play();

      const texture = new THREE.VideoTexture(video);
      const alphaTexture = new THREE.VideoTexture(alphaVideo);
      texture.minFilter = THREE.LinearFilter;
      alphaTexture.minFilter = THREE.LinearFilter;

      const geometry = new THREE.PlaneGeometry(1, 0.5625);
      const material = new THREE.ShaderMaterial({
        uniforms: {
          uTexture: { value: texture },
          uAlpha: { value: alphaTexture }
        },
        vertexShader: `
          varying vec2 vUv;
          void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
          }
        `,
        fragmentShader: `
          uniform sampler2D uTexture;
          uniform sampler2D uAlpha;
          varying vec2 vUv;
          void main() {
            vec4 color = texture2D(uTexture, vUv);
            vec4 alpha = texture2D(uAlpha, vUv);
            gl_FragColor = vec4(color.rgb, alpha.r);
          }
        `,
        transparent: true
      });

      const plane = new THREE.Mesh(geometry, material);
      plane.position.z = 0.01;

      const anchor = mindarThree.addAnchor(0);
      anchor.group.add(plane);

      await mindarThree.start();
      renderer.setAnimationLoop(() => {
        renderer.render(scene, camera);
      });
    });
  </script>
</body>
</html>
